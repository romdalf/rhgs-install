#-------------------------------------------------------------------------------------------#
# Ansible Playbook for RHGS
# 2019 - romuald@redhat.com 
#-------------------------------------------------------------------------------------------#
- hosts: dev
  gather_facts: false

  tasks:
  - name: Edit sysconfig nfs file for statd ports 
    become: yes
    ignore_errors: true
    shell: "sed -i '/STATD_PORT/s/^{{ '#' }}//' /etc/sysconfig/nfs"
    register: status

  - name: Restart NFS & RPC services
    service:
      name: nfs-config,rpc-statd
      state: restarted

  - name: Stop NFS Server
    service:
      name: nfs-server
      state: stopped

  - name: Disable NFS Server
    service:
      name: nfs-server
      enabled: no

  - name: Configure firewall (TCP) for NFS Ganesha
    become: yes
    firewalld: 
      zone: public
      port: "{{ item }}/tcp"
      permanent: true
      state: enabled
      immediate: yes
    with_items: [622,875,2049,2224,3121,20048,21064,32803]
#[111,139,445,965,2049,24007,24009,38465,38466,38468,38469,39543,49152,55863]

  - name: Configure firewall (UDP) for NFS Ganesha
    become: yes
    firewalld: 
      zone: public 
      port: "{{item}}/udp"
      permanent: true 
      state: enabled
      immediate: yes
    with_items: [662,875,2049,5404,5405,20048,32803,32769]

 